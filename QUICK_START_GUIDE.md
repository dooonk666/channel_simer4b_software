# 配置导入功能 - 快速使用指南

## 功能位置

在主界面中部，输出控制区域的右侧：
- **导入配置** 按钮
- **应用配置** 按钮（初始为灰色禁用状态）
- 下方有一个状态标签显示当前配置状态

## 使用步骤

### 第一步：导入JSON配置文件

1. 点击 **"导入配置"** 按钮
2. 在文件选择对话框中，选择你的JSON配置文件（例如：`3GPP_UMa_Stochastic.json`）
3. 系统会自动：
   - 读取并验证JSON文件
   - 检查clusters数量（最多支持24个）
   - 显示导入状态
   - 启用"应用配置"按钮

**成功提示示例：**
```
状态栏：成功导入配置：12个多径
状态标签：已导入配置：12个多径
```

**��果文件超过24个clusters：**
```
状态栏：警告：配置文件包含25个cluster，将只使用前24个
```

### 第二步：建立设备连接

1. 点击菜单栏的 **"连接"** 按钮
2. 等待连接建立成功
3. 状态栏会显示："连接建立..."

### 第三步：选择输入输出端口

1. 在界面上方的"信道"区域
2. 选择输入端口（Input）
3. 选择输出端口（Output）

### 第四步：应用配置

1. 点击 **"应用配置"** 按钮
2. 系统会自动：
   - 读取导入的配置数据
   - 将每个cluster的delay和power转换为设备参数
   - 生成完整的参数帧
   - 发送到设备
   - 更新界面连线图

**成功提示示例：**
```
状态栏：已应用配置：12个多径已发送
状态标签：已应用：12个��径
```

## 注意事项

### ✅ 正常使用场景

- JSON文件格式正确，包含clusters数组
- clusters数量 ≤ 24
- 设备已通过TCP连接
- 已选择���入输出端口

### ⚠️ 常见问题

**问题1：点击"应用配置"提示"设备未连接"**
- 解决：先点击菜单栏的"连接"按钮建立TCP连接

**问题2：JSON解析错误**
- 解决：检查JSON文件格式是否正确
- 必须��含 `clusters` 字段
- 每个cluster必须有 `delay` 和 `power` 字段

**问题3：导入后"应用配置"按钮仍然灰色**
- 解决：检查是否有错误提示，重新导入文件

## JSON文件要求

必须包含的字段：
```json
{
    "clusters": [
        {
            "delay": 0.0,              // 时延，单位：秒
            "power": 0.172694041,      // 相对功率，0-1之间
            ...                        // 其他字段可选
        }
    ]
}
```

## 与手动配置的关系

- **导入配置**：一次性配置多个多径，适合复杂场景
- **手动配置**：使用界面上的原有控件，精确控制单个多径

两种方式可以混合使用，互不干扰。

## 技术细节

### 参数转换

1. **时延转换：**
   ```
   JSON中的delay (秒) 
   → × 1e9 → 纳秒
   → ÷ 5 (CLK_TS) → 时钟周期数
   → 发送到设备
   ```

2. **功率转换：**
   ```
   JSON中的power (相对功率)
   → -10*log10(power) → 衰减dB
   → 10^(-dB/20) * 2^15 → k值
   → 发送到设备
   ```

### 发送的参数

对每个多径，会配置以下参数：
- ��径使能：1（启用）
- 多径时延：从delay转换
- 多径幅值衰减：从power转换
- 分数时延：0（默认）
- 多径频移：0（默认）
- 相偏：0（默认）
- 瑞利衰落使能：0（默认不启用）

对于未使用的多径（JSON中没有的），会发送禁用指令。

## 示例场景

### 场景1：3GPP信道模型仿真

1. 使用3GPP信道模型生成器生成JSON文件
2. 导入到上位机
3. 选择对应的输入输出端口
4. 应用配置
5. 开始测试

### 场景2：快速切换不同场景

1. 准备多个场景的JSON文件（UMa、UMi、InH等）
2. 通过导入配置快速切换
3. 无需手动调整每个参数

## 性能

- 导入速度：<1秒
- 帧生成：<1秒
- 发送延迟：取决于网络状况
- 支持的最大配置：24个多径

## 反馈

如果遇到问题，请查看：
1. 状态栏的错误提示
2. 状态标签的详细信息
3. 确认JSON文件格式是否正确

